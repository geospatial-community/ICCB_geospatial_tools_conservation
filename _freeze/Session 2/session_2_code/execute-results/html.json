{
  "hash": "fc7e5ea869c3df674e79e53c109d2fdd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Climate downscaling\"\nauthor: \"Ralph Trancoso, Sarah Chapman, Rohan Eccles\"\ndate: today\nexecute: \n  cache: false\ntoc: true\nnumber-sections: false\nformat: \n  html:\n    self-contained: true\n    code-fold: show\n    code-tools: true\n    df-print: paged\n    code-line-numbers: true\n    code-overflow: scroll\n    fig-format: png\n    fig-dpi: 300\n  pdf:\n    geometry: \n      - top=30mm\n      - left=30mm\neditor:\n  source\n---\n\n\n\n\n\n\n# Install packages\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"terra\")\n#install.packages(\"dplyr\")\n#install.packages(\"sf\")\n#install.packages(\"ggplot2\")\n#install.packages(\"dismo\")\n#install.packages(\"rasterVis\")\n#install.packages(\"reshape\")\n\n## Import packages\nlibrary(terra)\nlibrary(dplyr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(dismo)\nlibrary(rasterVis)\nlibrary(reshape)\nlibrary(RColorBrewer)\n```\n:::\n\n\n\n\n\n\n# Part 1: Temperature Data (one model)\n\nSet working directory\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#setwd(\"C:/R Code/Training/ICCB/\")\ngetwd()                   # get work directory\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/Users/scottforrest/Library/CloudStorage/OneDrive-QueenslandUniversityofTechnology/PhD - Scott Forrest/GIT/ICCB_geospatial_tools_conservation/Session 2\"\n```\n\n\n:::\n\n```{.r .cell-code}\ndir()                     # list folders in the work directory\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"data\"                                     \n [2] \"ICCB2025_Session2_ClimateProjections.pdf\" \n [3] \"ICCB2025_Session2_ClimateProjections.pptx\"\n [4] \"README.md\"                                \n [5] \"scripts\"                                  \n [6] \"session_2_code_files\"                     \n [7] \"session_2_code.qmd\"                       \n [8] \"session_2_code.rmarkdown\"                 \n [9] \"session_2_home.html\"                      \n[10] \"session_2_home.pdf\"                       \n[11] \"session_2_home.qmd\"                       \n```\n\n\n:::\n\n```{.r .cell-code}\ndir(\"data/annual/\")       # List files in subdirectory\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"pr_ACCESS-ESM1-5_ssp126_r6i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\" \n [2] \"pr_ACCESS-ESM1-5_ssp245_r6i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\" \n [3] \"pr_ACCESS-ESM1-5_ssp370_r6i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\" \n [4] \"pr_EC-Earth3_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"     \n [5] \"pr_EC-Earth3_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"     \n [6] \"pr_EC-Earth3_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"     \n [7] \"pr_GFDL-ESM4_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"     \n [8] \"pr_GFDL-ESM4_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"     \n [9] \"pr_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"     \n[10] \"tas_ACCESS-ESM1-5_ssp126_r6i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"\n[11] \"tas_ACCESS-ESM1-5_ssp245_r6i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"\n[12] \"tas_ACCESS-ESM1-5_ssp370_r6i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"\n[13] \"tas_EC-Earth3_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"    \n[14] \"tas_EC-Earth3_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"    \n[15] \"tas_EC-Earth3_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"    \n[16] \"tas_GFDL-ESM4_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"    \n[17] \"tas_GFDL-ESM4_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"    \n[18] \"tas_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"    \n```\n\n\n:::\n:::\n\n\n\n\n\n\nRetrieve file names in the directory\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfiles=dir(\"data/annual/\")\nfiles[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"pr_ACCESS-ESM1-5_ssp126_r6i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\"\n```\n\n\n:::\n:::\n\n\n\n\n\n\nLoad file and query data (working with one model)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntas = rast(\"data/annual/tas_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc\")\ntas \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 205, 176, 120  (nrow, ncol, nlyr)\nresolution  : 0.1, 0.1  (x, y)\nextent      : 137.45, 155.05, -29.45, -8.95  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (CRS84) (OGC:CRS84) \nsource      : tas_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc \nvarname     : tas_annual (Seasonal average of Near-Surface Air Temperature (Annual)) \nnames       : tas_annual_1, tas_annual_2, tas_annual_3, tas_annual_4, tas_annual_5, tas_annual_6, ... \nunit        :         degC,         degC,         degC,         degC,         degC,         degC, ... \ntime (days) : 1981-01-01 to 2100-01-01 (2 steps) \n```\n\n\n:::\n:::\n\n\n\n\n\n\nCheck your lat and lon coords\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxFromCol(tas)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1] 137.5 137.6 137.7 137.8 137.9 138.0 138.1 138.2 138.3 138.4 138.5 138.6\n [13] 138.7 138.8 138.9 139.0 139.1 139.2 139.3 139.4 139.5 139.6 139.7 139.8\n [25] 139.9 140.0 140.1 140.2 140.3 140.4 140.5 140.6 140.7 140.8 140.9 141.0\n [37] 141.1 141.2 141.3 141.4 141.5 141.6 141.7 141.8 141.9 142.0 142.1 142.2\n [49] 142.3 142.4 142.5 142.6 142.7 142.8 142.9 143.0 143.1 143.2 143.3 143.4\n [61] 143.5 143.6 143.7 143.8 143.9 144.0 144.1 144.2 144.3 144.4 144.5 144.6\n [73] 144.7 144.8 144.9 145.0 145.1 145.2 145.3 145.4 145.5 145.6 145.7 145.8\n [85] 145.9 146.0 146.1 146.2 146.3 146.4 146.5 146.6 146.7 146.8 146.9 147.0\n [97] 147.1 147.2 147.3 147.4 147.5 147.6 147.7 147.8 147.9 148.0 148.1 148.2\n[109] 148.3 148.4 148.5 148.6 148.7 148.8 148.9 149.0 149.1 149.2 149.3 149.4\n[121] 149.5 149.6 149.7 149.8 149.9 150.0 150.1 150.2 150.3 150.4 150.5 150.6\n[133] 150.7 150.8 150.9 151.0 151.1 151.2 151.3 151.4 151.5 151.6 151.7 151.8\n[145] 151.9 152.0 152.1 152.2 152.3 152.4 152.5 152.6 152.7 152.8 152.9 153.0\n[157] 153.1 153.2 153.3 153.4 153.5 153.6 153.7 153.8 153.9 154.0 154.1 154.2\n[169] 154.3 154.4 154.5 154.6 154.7 154.8 154.9 155.0\n```\n\n\n:::\n\n```{.r .cell-code}\nyFromRow(tas)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1]  -9.0  -9.1  -9.2  -9.3  -9.4  -9.5  -9.6  -9.7  -9.8  -9.9 -10.0 -10.1\n [13] -10.2 -10.3 -10.4 -10.5 -10.6 -10.7 -10.8 -10.9 -11.0 -11.1 -11.2 -11.3\n [25] -11.4 -11.5 -11.6 -11.7 -11.8 -11.9 -12.0 -12.1 -12.2 -12.3 -12.4 -12.5\n [37] -12.6 -12.7 -12.8 -12.9 -13.0 -13.1 -13.2 -13.3 -13.4 -13.5 -13.6 -13.7\n [49] -13.8 -13.9 -14.0 -14.1 -14.2 -14.3 -14.4 -14.5 -14.6 -14.7 -14.8 -14.9\n [61] -15.0 -15.1 -15.2 -15.3 -15.4 -15.5 -15.6 -15.7 -15.8 -15.9 -16.0 -16.1\n [73] -16.2 -16.3 -16.4 -16.5 -16.6 -16.7 -16.8 -16.9 -17.0 -17.1 -17.2 -17.3\n [85] -17.4 -17.5 -17.6 -17.7 -17.8 -17.9 -18.0 -18.1 -18.2 -18.3 -18.4 -18.5\n [97] -18.6 -18.7 -18.8 -18.9 -19.0 -19.1 -19.2 -19.3 -19.4 -19.5 -19.6 -19.7\n[109] -19.8 -19.9 -20.0 -20.1 -20.2 -20.3 -20.4 -20.5 -20.6 -20.7 -20.8 -20.9\n[121] -21.0 -21.1 -21.2 -21.3 -21.4 -21.5 -21.6 -21.7 -21.8 -21.9 -22.0 -22.1\n[133] -22.2 -22.3 -22.4 -22.5 -22.6 -22.7 -22.8 -22.9 -23.0 -23.1 -23.2 -23.3\n[145] -23.4 -23.5 -23.6 -23.7 -23.8 -23.9 -24.0 -24.1 -24.2 -24.3 -24.4 -24.5\n[157] -24.6 -24.7 -24.8 -24.9 -25.0 -25.1 -25.2 -25.3 -25.4 -25.5 -25.6 -25.7\n[169] -25.8 -25.9 -26.0 -26.1 -26.2 -26.3 -26.4 -26.5 -26.6 -26.7 -26.8 -26.9\n[181] -27.0 -27.1 -27.2 -27.3 -27.4 -27.5 -27.6 -27.7 -27.8 -27.9 -28.0 -28.1\n[193] -28.2 -28.3 -28.4 -28.5 -28.6 -28.7 -28.8 -28.9 -29.0 -29.1 -29.2 -29.3\n[205] -29.4\n```\n\n\n:::\n:::\n\n\n\n\n\n\nAdding missing year values to the data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndates = seq(as.Date(\"1981-01-01\"), as.Date(\"2100-12-01\"), by=\"year\")\nnames(tas) = dates  # fixing the time data in the NetCDF\ntas\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 205, 176, 120  (nrow, ncol, nlyr)\nresolution  : 0.1, 0.1  (x, y)\nextent      : 137.45, 155.05, -29.45, -8.95  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (CRS84) (OGC:CRS84) \nsource      : tas_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc \nvarname     : tas_annual (Seasonal average of Near-Surface Air Temperature (Annual)) \nnames       : 1981-01-01, 1982-01-01, 1983-01-01, 1984-01-01, 1985-01-01, 1986-01-01, ... \nunit        :       degC,       degC,       degC,       degC,       degC,       degC, ... \ntime (days) : 1981-01-01 to 2100-01-01 (2 steps) \n```\n\n\n:::\n:::\n\n\n\n\n\n\nSub-setting and plotting the data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntas[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 205, 176, 1  (nrow, ncol, nlyr)\nresolution  : 0.1, 0.1  (x, y)\nextent      : 137.45, 155.05, -29.45, -8.95  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (CRS84) (OGC:CRS84) \nsource      : tas_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_sem_1981-2100.nc \nvarname     : tas_annual (Seasonal average of Near-Surface Air Temperature (Annual)) \nname        : 1981-01-01 \nunit        :       degC \ntime (days) : 1981-01-01 \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(tas[[1]])\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-7-1.png)\n:::\n\n```{.r .cell-code}\nplot(tas[[1:4]])\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-7-2.png)\n:::\n\n```{.r .cell-code}\nplot(tas[[117:120]])\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-7-3.png)\n:::\n:::\n\n\n\n\n\n\nCan also sub-set the data according to the date array\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(tas[[dates >= as.Date(\"1981-01-01\") & dates <= as.Date(\"1984-01-01\")]])\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-8-1.png)\n:::\n\n```{.r .cell-code}\nplot(tas[[dates >= as.Date(\"2097-01-01\") & dates <= as.Date(\"2100-01-01\")]])\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-8-2.png)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntas_base = mean(tas[[1:30]])      # Calculating climatology for baseline (1981-2010)\ntas_fut = mean(tas[[91:120]])     # Calculating climatology for future (2071-2100)\n```\n:::\n\n\n\n\n\n\n## Q: Can you cut the historical data and future based on the dates?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(tas_base)\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-11-1.png)\n:::\n\n```{.r .cell-code}\nplot(tas_fut)\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-11-2.png)\n:::\n:::\n\n\n\n\n\n\nChange in future temperature (future - base)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntas_dif = tas_fut - tas_base\nplot(tas_dif)\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-12-1.png)\n:::\n:::\n\n\n\n\n\n\n## Q. Can you make this plot nicer? Add a title and change the colours\n\nHint: You can set plot titles using 'main'\n\nControl the colours using col = brewer.pal(11, 'PaletteName') (see https://colorbrewer2.org/ for colour options)\n\nYou can plot multiple figures in one plot using par (mfrow = c(nrows, ncols))\n\nAlso check the instructions from Session 1!\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n\n\n\n\n\n\nExtracting out point data (timeseries)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntas[50,50]                  # extracts data from the 50th lat and 50th lon position\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"1981-01-01\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1982-01-01\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1983-01-01\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1984-01-01\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1985-01-01\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1986-01-01\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1987-01-01\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1988-01-01\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1989-01-01\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1990-01-01\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1991-01-01\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1992-01-01\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1993-01-01\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1994-01-01\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1995-01-01\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1996-01-01\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1997-01-01\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1998-01-01\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"1999-01-01\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2000-01-01\"],\"name\":[20],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2001-01-01\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2002-01-01\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2003-01-01\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2004-01-01\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2005-01-01\"],\"name\":[25],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2006-01-01\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2007-01-01\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2008-01-01\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2009-01-01\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2010-01-01\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2011-01-01\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2012-01-01\"],\"name\":[32],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2013-01-01\"],\"name\":[33],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2014-01-01\"],\"name\":[34],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2015-01-01\"],\"name\":[35],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2016-01-01\"],\"name\":[36],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2017-01-01\"],\"name\":[37],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2018-01-01\"],\"name\":[38],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2019-01-01\"],\"name\":[39],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2020-01-01\"],\"name\":[40],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2021-01-01\"],\"name\":[41],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2022-01-01\"],\"name\":[42],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2023-01-01\"],\"name\":[43],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2024-01-01\"],\"name\":[44],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2025-01-01\"],\"name\":[45],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2026-01-01\"],\"name\":[46],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2027-01-01\"],\"name\":[47],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2028-01-01\"],\"name\":[48],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2029-01-01\"],\"name\":[49],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2030-01-01\"],\"name\":[50],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2031-01-01\"],\"name\":[51],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2032-01-01\"],\"name\":[52],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2033-01-01\"],\"name\":[53],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2034-01-01\"],\"name\":[54],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2035-01-01\"],\"name\":[55],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2036-01-01\"],\"name\":[56],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2037-01-01\"],\"name\":[57],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2038-01-01\"],\"name\":[58],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2039-01-01\"],\"name\":[59],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2040-01-01\"],\"name\":[60],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2041-01-01\"],\"name\":[61],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2042-01-01\"],\"name\":[62],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2043-01-01\"],\"name\":[63],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2044-01-01\"],\"name\":[64],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2045-01-01\"],\"name\":[65],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2046-01-01\"],\"name\":[66],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2047-01-01\"],\"name\":[67],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2048-01-01\"],\"name\":[68],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2049-01-01\"],\"name\":[69],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2050-01-01\"],\"name\":[70],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2051-01-01\"],\"name\":[71],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2052-01-01\"],\"name\":[72],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2053-01-01\"],\"name\":[73],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2054-01-01\"],\"name\":[74],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2055-01-01\"],\"name\":[75],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2056-01-01\"],\"name\":[76],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2057-01-01\"],\"name\":[77],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2058-01-01\"],\"name\":[78],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2059-01-01\"],\"name\":[79],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2060-01-01\"],\"name\":[80],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2061-01-01\"],\"name\":[81],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2062-01-01\"],\"name\":[82],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2063-01-01\"],\"name\":[83],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2064-01-01\"],\"name\":[84],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2065-01-01\"],\"name\":[85],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2066-01-01\"],\"name\":[86],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2067-01-01\"],\"name\":[87],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2068-01-01\"],\"name\":[88],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2069-01-01\"],\"name\":[89],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2070-01-01\"],\"name\":[90],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2071-01-01\"],\"name\":[91],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2072-01-01\"],\"name\":[92],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2073-01-01\"],\"name\":[93],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2074-01-01\"],\"name\":[94],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2075-01-01\"],\"name\":[95],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2076-01-01\"],\"name\":[96],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2077-01-01\"],\"name\":[97],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2078-01-01\"],\"name\":[98],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2079-01-01\"],\"name\":[99],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2080-01-01\"],\"name\":[100],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2081-01-01\"],\"name\":[101],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2082-01-01\"],\"name\":[102],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2083-01-01\"],\"name\":[103],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2084-01-01\"],\"name\":[104],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2085-01-01\"],\"name\":[105],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2086-01-01\"],\"name\":[106],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2087-01-01\"],\"name\":[107],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2088-01-01\"],\"name\":[108],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2089-01-01\"],\"name\":[109],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2090-01-01\"],\"name\":[110],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2091-01-01\"],\"name\":[111],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2092-01-01\"],\"name\":[112],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2093-01-01\"],\"name\":[113],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2094-01-01\"],\"name\":[114],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2095-01-01\"],\"name\":[115],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2096-01-01\"],\"name\":[116],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2097-01-01\"],\"name\":[117],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2098-01-01\"],\"name\":[118],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2099-01-01\"],\"name\":[119],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2100-01-01\"],\"name\":[120],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"25.24902\",\"2\":\"25.26156\",\"3\":\"24.88015\",\"4\":\"24.41082\",\"5\":\"24.94491\",\"6\":\"24.89218\",\"7\":\"25.25115\",\"8\":\"25.23535\",\"9\":\"25.03982\",\"10\":\"25.42452\",\"11\":\"25.37658\",\"12\":\"25.3677\",\"13\":\"25.10143\",\"14\":\"25.3218\",\"15\":\"24.87841\",\"16\":\"25.11816\",\"17\":\"25.46691\",\"18\":\"25.25924\",\"19\":\"25.05966\",\"20\":\"25.53942\",\"21\":\"25.29299\",\"22\":\"25.82775\",\"23\":\"25.32467\",\"24\":\"25.54989\",\"25\":\"25.65566\",\"26\":\"25.43701\",\"27\":\"25.56466\",\"28\":\"25.35082\",\"29\":\"25.64773\",\"30\":\"25.44879\",\"31\":\"25.77899\",\"32\":\"25.52069\",\"33\":\"26.40573\",\"34\":\"26.00399\",\"35\":\"26.02764\",\"36\":\"25.50436\",\"37\":\"25.88986\",\"38\":\"26.02621\",\"39\":\"25.68951\",\"40\":\"25.9519\",\"41\":\"25.43524\",\"42\":\"26.02264\",\"43\":\"26.07147\",\"44\":\"25.98385\",\"45\":\"26.4558\",\"46\":\"25.86419\",\"47\":\"26.31649\",\"48\":\"25.50891\",\"49\":\"26.05761\",\"50\":\"26.26635\",\"51\":\"26.16805\",\"52\":\"25.56466\",\"53\":\"25.6921\",\"54\":\"26.2561\",\"55\":\"26.34539\",\"56\":\"25.9425\",\"57\":\"26.57571\",\"58\":\"26.29916\",\"59\":\"26.85446\",\"60\":\"26.48287\",\"61\":\"26.22824\",\"62\":\"26.75714\",\"63\":\"26.34863\",\"64\":\"26.01452\",\"65\":\"26.37426\",\"66\":\"26.30599\",\"67\":\"26.89645\",\"68\":\"26.49154\",\"69\":\"26.71673\",\"70\":\"26.64852\",\"71\":\"26.51864\",\"72\":\"26.47985\",\"73\":\"26.61602\",\"74\":\"26.9179\",\"75\":\"26.97494\",\"76\":\"26.73034\",\"77\":\"27.19863\",\"78\":\"27.05032\",\"79\":\"26.64703\",\"80\":\"27.30004\",\"81\":\"26.55456\",\"82\":\"27.39593\",\"83\":\"27.40051\",\"84\":\"27.23416\",\"85\":\"27.5408\",\"86\":\"27.24737\",\"87\":\"27.33636\",\"88\":\"27.09204\",\"89\":\"27.59817\",\"90\":\"26.69656\",\"91\":\"27.19824\",\"92\":\"26.80004\",\"93\":\"27.00533\",\"94\":\"28.2991\",\"95\":\"27.67822\",\"96\":\"27.7326\",\"97\":\"27.16381\",\"98\":\"28.68814\",\"99\":\"27.56314\",\"100\":\"27.8674\",\"101\":\"27.92907\",\"102\":\"27.94192\",\"103\":\"27.6759\",\"104\":\"27.62152\",\"105\":\"27.59582\",\"106\":\"28.27426\",\"107\":\"27.941\",\"108\":\"28.31573\",\"109\":\"27.85235\",\"110\":\"27.81686\",\"111\":\"27.98327\",\"112\":\"28.39962\",\"113\":\"28.12872\",\"114\":\"28.79971\",\"115\":\"28.32763\",\"116\":\"27.89684\",\"117\":\"28.33975\",\"118\":\"27.95684\",\"119\":\"28.80871\",\"120\":\"28.1459\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ncells <- cellFromRowCol(tas[[1]], 50, 50)\nxyFromCell(tas,cells)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         x     y\n[1,] 142.4 -13.9\n```\n\n\n:::\n\n```{.r .cell-code}\ndf = melt(tas[50,50])\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nUsing  as id variables\n```\n\n\n:::\n:::\n\n\n\n\n\n\nBasic plot\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(df, xlab = \"Year\", ylab = \"Temperature (degC)\")\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-15-1.png)\n:::\n:::\n\n\n\n\n\n\nCalculating spatial average of all data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspat_ave = global(tas, fun=mean, na.rm=TRUE)\nspat_ave$date = dates\n```\n:::\n\n\n\n\n\n\nggplot\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = spat_ave, aes(y=mean, x=date))+ \n  ylab('Temperature (degC)') + xlab('Year') +\n  geom_point() +\n  geom_line() +\n  geom_smooth(method = \"lm\") +\n  theme_bw()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-17-1.png)\n:::\n:::\n\n\n\n\n\n\n## Q. Can you add another model to this plot and compare the two?\n\nHint: You'll need to prepare a dataframe with data for all models in it. One of the columns will need to be the values, and the other the model name.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n\n\n\n\n\n\n# Part 2: Rainfall Data (multiple models)\n\n## Working with multiple Models\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr_files <- list.files(path = \"data/annual/\", pattern = \"pr\", full.names = TRUE)            # Lists all files, including all scenarios\npr_files <- list.files(path = \"data/annual/\", pattern = \"pr.*ssp370\", full.names = TRUE)    # Lists files with only ssp370\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npr_data = rast(pr_files)*365  # daily mean to annual total. CCAM has a 365 day calendar.\npr_data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 205, 176, 360  (nrow, ncol, nlyr)\nresolution  : 0.1, 0.1  (x, y)\nextent      : 137.45, 155.05, -29.45, -8.95  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (CRS84) (OGC:CRS84) \nsource(s)   : memory\nvarname     : pr_annual (Seasonal average of Precipitation (Annual)) \nnames       : pr_annual_1, pr_annual_2, pr_annual_3, pr_annual_4, pr_annual_5, pr_annual_6, ... \nmin values  :      52.196,    48.72456,    85.55378,    54.58001,    150.5908,    117.2378, ... \nmax values  :    6151.675,  7233.45194,  5595.35947,  6152.59279,   5482.5640,   5449.5375, ... \ntime (days) : 1981-01-01 to 2100-01-01 (2 steps) \n```\n\n\n:::\n:::\n\n\n\n\n\n\nRepeating the year names multiple times to correspond with multiple models\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyears = seq(1981,2100)\nyears_rep = rep(years, times =3)\nnames(pr_data) = years_rep\n```\n:::\n\n\n\n\n\n\nCalculating the model average\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr_modavg = tapp(pr_data, years, fun = mean)\n\n# Calculating climatology for baseline (1981-2010)\npr_base = mean(pr_modavg[[1:30]])  # Converting from daily mean to annual mean\n\n# Calculating climatology for future (2071-2100)\npr_fut = mean(pr_modavg[[91:120]])  # Converting from daily mean to annual mean\n```\n:::\n\n\n\n\n\n\n## Q: Can you select the data based on the years instead?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n\n\n\n\n\n\nPlot historic and future rainfall\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevelplot(pr_base)\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-24-1.png)\n:::\n\n```{.r .cell-code}\nlevelplot(pr_fut)\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-24-2.png)\n:::\n:::\n\n\n\n\n\n\nCutting data to Queensland\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqld_shp = vect('data/shp/QLD_State_Mask.shp')\npr_dif = pr_fut - pr_base\npr_dif_masked <- crop(pr_dif, qld_shp, mask = TRUE)\nlevelplot(pr_dif_masked, margin = FALSE)\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-25-1.png)\n:::\n:::\n\n\n\n\n\n\nPlotting the percent change\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr_pdif = (pr_fut - pr_base ) / pr_base *100  #Percent difference\npr_pdif_masked <- crop(pr_pdif, qld_shp, mask = TRUE)\nlevelplot(pr_pdif_masked, margin = FALSE)\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-26-1.png)\n:::\n:::\n\n\n\n\n\n\nSpecifying plotting bins and colours\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy.at <- seq(-20, 20, length.out = 10)\nmy.at = c(-Inf, my.at, Inf)\nlevelplot(pr_pdif_masked, margin = FALSE, at = my.at, cuts=11, pretty=T,\n                col.regions=((brewer.pal(11,\"RdBu\"))))\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-27-1.png)\n:::\n:::\n\n\n\n\n\n\n## Q. Can you modify this plot to show more infomation? Can you add a title and change the colours?\n\nWould showing multiple models on this plot help?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n\n\n\n\n\n\n## Q. Can we compare the results from SSP370 to another Scenario?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n\n\n\n\n\n\n# Part 3: Validating your data Calculating BioClim Indices\n\nList monthly climate files\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndir(\"data/monthly/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"pr_ACCESS-CM2_ssp126_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"    \n [2] \"pr_ACCESS-CM2_ssp245_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"    \n [3] \"pr_ACCESS-CM2_ssp370_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"    \n [4] \"pr_EC-Earth3_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"       \n [5] \"pr_EC-Earth3_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"       \n [6] \"pr_EC-Earth3_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"       \n [7] \"pr_GFDL-ESM4_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"       \n [8] \"pr_GFDL-ESM4_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"       \n [9] \"pr_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"       \n[10] \"tasmax_ACCESS-CM2_ssp126_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"\n[11] \"tasmax_ACCESS-CM2_ssp245_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"\n[12] \"tasmax_ACCESS-CM2_ssp370_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"\n[13] \"tasmax_EC-Earth3_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[14] \"tasmax_EC-Earth3_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[15] \"tasmax_EC-Earth3_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[16] \"tasmax_GFDL-ESM4_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[17] \"tasmax_GFDL-ESM4_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[18] \"tasmax_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[19] \"tasmin_ACCESS-CM2_ssp126_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"\n[20] \"tasmin_ACCESS-CM2_ssp245_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"\n[21] \"tasmin_ACCESS-CM2_ssp370_r2i1p1f1_CCAM10oc_aus-10i_10km_mon_1981-2100.nc\"\n[22] \"tasmin_EC-Earth3_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[23] \"tasmin_EC-Earth3_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[24] \"tasmin_EC-Earth3_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[25] \"tasmin_GFDL-ESM4_ssp126_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[26] \"tasmin_GFDL-ESM4_ssp245_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n[27] \"tasmin_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\"   \n```\n\n\n:::\n:::\n\n\n\n\n\n\nLoad shapefile for Sunshine Coast\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlga_shp = vect('data/shp/SunshineCoast.shp')\n```\n:::\n\n\n\n\n\n\nLoad monthly climate data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmax = rast(\"data/monthly/tasmax_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\")\ntmin = rast(\"data/monthly/tasmin_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\")\npr = rast(\"data/monthly/pr_GFDL-ESM4_ssp370_r1i1p1f1_CCAM10_aus-10i_10km_mon_1981-2100.nc\")\n```\n:::\n\n\n\n\n\n\nAssign time labels\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndates <- seq(as.Date(\"1981-01-01\"), as.Date(\"2100-12-01\"), by = \"month\")\nnames(tmax) = dates\nnames(tmin) = dates\nnames(pr) = dates\n```\n:::\n\n\n\n\n\n\nPlot temperature minimum\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp_stack <- mean(tmin[[1:360]])\nlga_shp2 <- as(lga_shp, \"Spatial\")\nqld2 <- as(qld_shp, \"Spatial\")\nlevelplot(temp_stack, margin = FALSE, par.settings = BuRdTheme, main = 'TMIN') +\n  latticeExtra::layer(sp.polygons(lga_shp2, col = 'blue')) +\n  latticeExtra::layer(sp.polygons(qld2))\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-34-1.png)\n:::\n:::\n\n\n\n\n\n\nLoad observational data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndir(\"data/obs/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"agcd_v1_precip_r005_daily_1981_2020.nc\"\n[2] \"agcd_v1_tmax_r005_daily_1981_2020.nc\"  \n[3] \"agcd_v1_tmin_r005_daily_1981_2020.nc\"  \n```\n\n\n:::\n\n```{.r .cell-code}\nobs_tmax = rast(list.files(path = \"data/obs/\", pattern = \"tmax\", full.names = TRUE))\nobs_tmin = rast(list.files(path = \"data/obs/\", pattern = \"tmin\", full.names = TRUE))\nobs_pr = rast(list.files(path = \"data/obs/\", pattern = \"precip\", full.names = TRUE))\n```\n:::\n\n\n\n\n\n\nResample observational data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobs_tmax_regridded <- resample(obs_tmax, tmax, method = \"bilinear\")\nobs_tmin_regridded <- resample(obs_tmin, tmin, method = \"bilinear\")\nobs_pr_regridded <- resample(obs_pr, pr, method = \"bilinear\")\n```\n:::\n\n\n\n\n\n\nExtract historical slices\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmax_his = tmax[[dates >= as.Date(\"1981-01-01\") & dates < as.Date(\"2021-01-01\")]]\ntmin_his = tmin[[dates >= as.Date(\"1981-01-01\") & dates < as.Date(\"2021-01-01\")]]\npr_his = pr[[dates >= as.Date(\"1981-01-01\") & dates < as.Date(\"2021-01-01\")]]\n```\n:::\n\n\n\n\n\n\nEvaluate tmin bias\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmin_bias = mean(tmin_his) - mean(obs_tmin_regridded)\ntmin_bias_masked <- crop(tmin_bias, qld_shp, mask = TRUE)\n\nmy.at <- c(-Inf, seq(-3, 3, length.out = 10), Inf)\nlevelplot(tmin_bias_masked, at = my.at, margin = FALSE, cuts = 11, pretty = TRUE,\n          main = 'Tmin bias (degC)',\n          col.regions = rev(brewer.pal(11, \"RdBu\"))) +\n  latticeExtra::layer(sp.polygons(lga_shp2, col = 'blue')) +\n  latticeExtra::layer(sp.polygons(qld2))\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-38-1.png)\n:::\n:::\n\n\n\n\n\n\nBias metrics\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrmse = global((mean(tmin_his) - mean(obs_tmin_regridded))^2, fun = \"mean\", na.rm = TRUE)[1]\nmape = global(abs((mean(tmin_his) - mean(obs_tmin_regridded)) / mean(obs_tmin_regridded)) * 100, fun = \"mean\", na.rm = TRUE)[1]\nprint(paste(\"RMSE:\", rmse))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"RMSE: 3.48752996185524\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(paste(\"MAPE:\", mape))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"MAPE: 11.8785189666455\"\n```\n\n\n:::\n:::\n\n\n\n\n\n\nMask climate data to Sunshine Coast\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr_masked <- crop(pr, lga_shp, mask = TRUE)\ntmin_masked <- crop(tmin, lga_shp, mask = TRUE)\ntmax_masked <- crop(tmax, lga_shp, mask = TRUE)\n```\n:::\n\n\n\n\n\n\nSpatial averages\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr_ave_coarse = global(pr_masked, fun = mean, na.rm = TRUE)\ntmin_ave_coarse = global(tmin_masked, fun = mean, na.rm = TRUE)\ntmax_ave_coarse = global(tmax_masked, fun = mean, na.rm = TRUE)\n```\n:::\n\n\n\n\n\n\nPlot masked tmin\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmin_masked_mean <- mean(tmin_masked[[1:360]])\nlevelplot(tmin_masked_mean, margin = FALSE, par.settings = BuRdTheme, main = 'TMIN') +\n  latticeExtra::layer(sp.polygons(lga_shp2, col = 'blue'))\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-42-1.png)\n:::\n:::\n\n\n\n\n\n\nWeighted average\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr_ave = as.data.frame(t(terra::extract(pr, lga_shp, weights = TRUE, fun = mean, na.rm = TRUE, ID = FALSE)))\ntmin_ave = as.data.frame(t(terra::extract(tmin, lga_shp, weights = TRUE, fun = mean, na.rm = TRUE, ID = FALSE)))\ntmax_ave = as.data.frame(t(terra::extract(tmax, lga_shp, weights = TRUE, fun = mean, na.rm = TRUE, ID = FALSE)))\n```\n:::\n\n\n\n\n\n\nCompare averages\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\nplot(pr_ave_coarse$mean, pr_ave$V1, xlab = \"Average\", ylab = \"Spatial Average\")\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-44-1.png)\n:::\n:::\n\n\n\n\n\n\nPrepare dataframe for biovars\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(pr_ave)[1] <- \"pr\"\ncolnames(tmin_ave)[1] <- \"tmin\"\ncolnames(tmax_ave)[1] <- \"tmax\"\npr_ave$date <- rownames(pr_ave)\ntmin_ave$date <- rownames(tmin_ave)\ntmax_ave$date <- rownames(tmax_ave)\ndf <- merge(pr_ave, tmin_ave, by = \"date\", all = TRUE)\ndf <- merge(df, tmax_ave, by = \"date\", all = TRUE)\n```\n:::\n\n\n\n\n\n\nSubset to baseline and future\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf$date <- as.Date(df$date)\ndf$year <- as.numeric(format(df$date, \"%Y\"))\ndf_base = subset(df, year >= 1981 & year <= 2010)\ndf_fut = subset(df, year >= 2071 & year <= 2100)\n```\n:::\n\n\n\n\n\n\nCalculate biovars\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbio_base = biovars(df_base$pr, df_base$tmin, df_base$tmax)\nbio_fut = biovars(df_fut$pr, df_fut$tmin, df_fut$tmax)\nprint(bio_base[, c(\"bio5\", \"bio6\", \"bio12\", \"bio15\")])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       bio5        bio6       bio12       bio15 \n  31.247510    8.574035 1343.710569   88.641010 \n```\n\n\n:::\n\n```{.r .cell-code}\nprint(bio_fut[, c(\"bio5\", \"bio6\", \"bio12\", \"bio15\")])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      bio5       bio6      bio12      bio15 \n  36.10810   11.37925 1266.43503   74.49997 \n```\n\n\n:::\n:::\n\n\n\n\n\n\nFull raster bioclim calculation\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmax_base = tmax[[dates >= as.Date(\"1981-01-01\") & dates < as.Date(\"2011-01-01\")]]\ntmin_base = tmin[[dates >= as.Date(\"1981-01-01\") & dates < as.Date(\"2011-01-01\")]]\npr_base = pr[[dates >= as.Date(\"1981-01-01\") & dates < as.Date(\"2011-01-01\")]]\ntmax_fut = tmax[[dates >= as.Date(\"2071-01-01\") & dates < as.Date(\"2101-01-01\")]]\ntmin_fut = tmin[[dates >= as.Date(\"2071-01-01\") & dates < as.Date(\"2101-01-01\")]]\npr_fut = pr[[dates >= as.Date(\"2071-01-01\") & dates < as.Date(\"2101-01-01\")]]\n\nbioclim_input_base = c(pr_base, tmin_base, tmax_base)\nbioclim_input_fut = c(pr_fut, tmin_fut, tmax_fut)\n\nfun_bio_calc <- function(x) {\n  n <- length(x) / 3\n  pr <- x[1:n]\n  tmin <- x[(n + 1):(2 * n)]\n  tmax <- x[(2 * n + 1):(3 * n)]\n  bio <- biovars(pr, tmin, tmax)\n  return(bio)\n}\n\nbio_base <- app(bioclim_input_base, fun = fun_bio_calc)\nbio_fut <- app(bioclim_input_fut, fun = fun_bio_calc)\n\nplot(bio_base[[12]])\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-48-1.png)\n:::\n\n```{.r .cell-code}\nplot(bio_fut[[12]])\n```\n\n::: {.cell-output-display}\n![](session_2_code_files/figure-html/unnamed-chunk-48-2.png)\n:::\n:::\n\n\n\n\n\n\nDiscussion Questions\n\n## Q: Can you plot the bioclimatic indices in the past and present and compare the changes?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n\n\n\n\n\n\n## Q: What does the bioclimatic indicators look like for a lower emissions scenario?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add your code here!\n#\n#\n#\n#\n#\n#\n#\n#\n#\n#\n```\n:::\n",
    "supporting": [
      "session_2_code_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}