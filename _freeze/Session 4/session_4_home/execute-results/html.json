{
  "hash": "7d089b034e7781e4532f692b1d68ab70",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Session 4\"\nauthor: \"Brooke Williams, Caitie Kuemple\"\ndate: \"2025-06-11\"\nexecute: \n  cache: false\ntoc: true\nnumber-sections: false\nformat: \n  html:\n    self-contained: true\n    code-fold: show\n    code-tools: true\n    df-print: paged\n    code-line-numbers: true\n    code-overflow: scroll\n    fig-format: png\n    fig-dpi: 300\n  pdf:\n    geometry: \n      - top=30mm\n      - left=30mm\neditor:\n  source\nabstract: |\n  In this session we are using the prioritizr package to create a set of conservation scenarios for protecting the future distribution of koalas in the SEQ region. \n---\n\n\n\n\n## Install the rcbc package for the cbc optimization solver\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(remotes))\n  install.packages(\"remotes\")\nremotes::install_github(\"dirkschumacher/rcbc\")\n```\n:::\n\n\n\n\n## Install packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(terra)\nlibrary(viridisLite)\nlibrary(prioritizr)\nlibrary(raster)\nlibrary(sf)\nlibrary(rcbc)\n```\n:::\n\n\n\n\n## Load Spatial Data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the Planning unit\nPU <- terra::rast(\"data/otherdata/PlanningUnits.tif\")\nplot(PU, col = viridisLite::mako(n = 1))\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-2-1.png)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the file names of the testing data\nspp.list <- list.files(path = \"data/SpeciesDistributions/\", full.names = TRUE, recursive = TRUE, pattern = \".tif$\")\n```\n:::\n\n\n\n\n### Load current species distribution\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspp <- rast(spp.list[grep(\"current\", spp.list)])\nnew_names <- tools::file_path_sans_ext(basename(spp.list[grep(\"current\", spp.list)]))\nnames(spp) <- new_names\nplot(spp, axes = FALSE, col = viridisLite::mako(n = 100, direction = -1), main = names(spp))\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-4-1.png)\n:::\n:::\n\n\n\n\n### Load future species distribution\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspp <- rast(spp.list[grep(\"future\", spp.list)])\nnew_names <- tools::file_path_sans_ext(basename(spp.list[grep(\"future\", spp.list)]))\nnames(spp) <- new_names\nplot(spp, axes = FALSE, col = viridisLite::mako(n = 100, direction = -1), main = names(spp))\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-5-1.png)\n:::\n:::\n\n\n\n\n### Load protected areas, urban centers, and cost layer\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPA <- rast(\"data/otherdata/protected_areas.tif\")\nplot(PA, axes = FALSE, col = viridisLite::mako(n = 100, direction = -1), main = \"Protected Areas (I & II)\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-6-1.png)\n:::\n\n```{.r .cell-code}\nurban <- rast(\"data/otherdata/urban_centers.tif\")\nplot(urban, axes = FALSE, col = viridisLite::mako(n = 100, direction = -1), main = \"Urban Centers\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-6-2.png)\n:::\n\n```{.r .cell-code}\nhfp <- rast(\"data/otherdata/cost_hfp2013.tif\")\nplot(hfp, axes = FALSE, col = viridisLite::mako(n = 10, direction = -1), main = \"Global human footprint\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-6-3.png)\n:::\n:::\n\n\n\n\n## Define Budget\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbudget.area <- round(0.3 * length(cells(PU)))\n```\n:::\n\n\n\n\n## Scenario 1: Basic Shortfall Objective\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- problem(PU, spp) %>% \n  add_min_shortfall_objective(budget = budget.area) %>%\n  add_relative_targets(targets = 1) %>% \n  add_default_solver() %>%\n  add_proportion_decisions()\n\ns1 <- solve(p)\nplot(s1, main = \"Scenario 1\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-8-1.png)\n:::\n:::\n\n\n\n\n## Scenario 2: Lock Out Urban Areas\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- problem(PU, spp) %>% \n  add_min_shortfall_objective(budget = budget.area) %>%\n  add_relative_targets(targets = 1) %>%\n  add_proportion_decisions() %>%\n  add_locked_out_constraints(urban) %>%\n  add_default_solver()\n\ns2 <- solve(p)\nplot(s2, main = \"Scenario 2 - lock out\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-9-1.png)\n:::\n:::\n\n\n\n\n## Scenario 3: Lock In Protected Areas\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- problem(PU, spp) %>% \n  add_min_shortfall_objective(budget = budget.area) %>%\n  add_relative_targets(targets = 1) %>%\n  add_proportion_decisions() %>%\n  add_locked_in_constraints(PA) %>%\n  add_locked_out_constraints(urban) %>%\n  add_default_solver()\n\ns3 <- solve(p)\nplot(s3, main = \"Scenario 3 - lock in\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-10-1.png)\n:::\n:::\n\n\n\n\n## Scenario 4: Penalize Human Footprint\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- problem(PU, spp) %>% \n  add_min_shortfall_objective(budget = budget.area) %>%\n  add_relative_targets(targets = 1) %>%\n  add_linear_penalties(penalty = 1, data = hfp) %>%\n  add_proportion_decisions() %>%\n  add_locked_in_constraints(PA) %>%\n  add_locked_out_constraints(urban) %>%\n  add_default_solver()\n\ns4 <- solve(p)\nplot(s4, main = \"Scenario 4 - apply penalty\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-11-1.png)\n:::\n:::\n\n\n\n\n## Plot All Scenarios Side by Side\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(2, 2), mar = c(3, 3, 3, 1))\nplot(s1, main = \"Scenario 1\")\nplot(s2, main = \"Scenario 2 - lock out\")\nplot(s3, main = \"Scenario 3 - lock in\")\nplot(s4, main = \"Scenario 4 - apply penalty\")\n```\n\n::: {.cell-output-display}\n![](session_4_home_files/figure-html/unnamed-chunk-12-1.png)\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\n```\n:::\n\n\n\n\n## Evaluate Metrics\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrpz_target_spp_s1 <- eval_target_coverage_summary(p, s1) \nmean(rpz_target_spp_s1$relative_held)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3464172\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(rpz_target_spp_s1$relative_shortfall)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6535828\n```\n\n\n:::\n\n```{.r .cell-code}\nrpz_target_spp_s2 <- eval_target_coverage_summary(p, s2) \nmean(rpz_target_spp_s2$relative_held)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3440511\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(rpz_target_spp_s2$relative_shortfall)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6559489\n```\n\n\n:::\n\n```{.r .cell-code}\nrpz_target_spp_s3 <- eval_target_coverage_summary(p, s3) \nmean(rpz_target_spp_s3$relative_held)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3294218\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(rpz_target_spp_s3$relative_shortfall)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6705782\n```\n\n\n:::\n\n```{.r .cell-code}\nrpz_target_spp_s4 <- eval_target_coverage_summary(p, s4) \nmean(rpz_target_spp_s4$relative_held)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1013999\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(rpz_target_spp_s4$relative_shortfall)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8986001\n```\n\n\n:::\n:::\n",
    "supporting": [
      "session_4_home_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}